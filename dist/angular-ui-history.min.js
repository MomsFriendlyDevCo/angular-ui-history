"use strict";angular.module("angular-ui-history",["angular-bs-tooltip","ngQuill","ui.gravatar"]).provider("uiHistory",function(){this.defaults={},this.$get=function(){return this}}).component("uiHistory",{bindings:{allowPost:"<",allowUpload:"<",allowUploadList:"<",buttons:"<",display:"<",queryUrl:"<",postUrl:"<",templates:"<",onError:"&?",onLoadingStart:"&?",onLoadingStop:"&?",onQuery:"&?",onUpload:"&?"},template:'\n\t\t<div class="ui-history">\n\t\t\t\x3c!-- Modal: Upload list {{{ --\x3e\n\t\t\t<div class="modal fade angular-ui-history-modal-uploadList">\n\t\t\t\t<div ng-if="$ctrl.showFilesModal" class="modal-dialog">\n\t\t\t\t\t<div class="modal-content">\n\t\t\t\t\t\t<div class="modal-header">\n\t\t\t\t\t\t\t<a class="close" data-dismiss="modal"><i class="fa fa-times"></i></a>\n\t\t\t\t\t\t\t<h4 class="modal-title">Upload List</h4>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="modal-body">\n\t\t\t\t\t\t\t<ui-history-files\n\t\t\t\t\t\t\t\tallow-upload="$ctrl.allowUpload"\n\t\t\t\t\t\t\t\tquery-url="$ctrl.queryUrl"\n\t\t\t\t\t\t\t\tpost-url="$ctrl.postUrl"\n\t\t\t\t\t\t\t\ton-error="$ctrl.onError"\n\t\t\t\t\t\t\t\ton-loading-start="$ctrl.onLoadingStart"\n\t\t\t\t\t\t\t\ton-loading-stop="$ctrl.onLoadingStop"\n\t\t\t\t\t\t\t\ton-query="$ctrl.onQuery"\n\t\t\t\t\t\t\t\ton-upload="$ctrl.onUpload"\n\t\t\t\t\t\t\t></ui-history-files>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!-- }}} --\x3e\n\t\t\t<div style="display: none">\n\t\t\t\t<input id="angular-ui-history-upload-helper" name="file" multiple type="file"/>\n\t\t\t</div>\n\t\t\t\x3c!-- Header editor (if display=\'recentFirst\') {{{ --\x3e\n\t\t\t<div ng-if="$ctrl.allowPost && $ctrl.display == \'recentFirst\'">\n\t\t\t\t<div ng-show="$ctrl.isPosting" class="text-center">\n\t\t\t\t\t<h3><i class="fa fa-spinner fa-spin"></i> Posting...</h3>\n\t\t\t\t</div>\n\t\t\t\t<div ng-show="!$ctrl.isPosting">\n\t\t\t\t\t<ui-history-editor\n\t\t\t\t\t\tbuttons="$ctrl.buttons"\n\t\t\t\t\t\ttemplates="$ctrl.templates"\n\t\t\t\t\t\ton-post="$ctrl.makePost(body)"\n\t\t\t\t\t></ui-history-editor>\n\t\t\t\t</div>\n\t\t\t\t<hr/>\n\t\t\t</div>\n\t\t\t\x3c!-- }}} --\x3e\n\t\t\t<div ng-repeat="post in $ctrl.posts | orderBy:\'date\':$ctrl.display==\'recentFirst\' track by post._id" ng-switch="post.type" class="ui-history-item">\n\t\t\t\t<div class="ui-history-meta">\n\t\t\t\t\t<div ng-if="post.tags && post.tags.length" class="ui-history-tags">\n\t\t\t\t\t\t<span ng-repeat="tag in post.tags" class="ui-history-tag">\n\t\t\t\t\t\t\t{{tag}}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-history-timestamp" tooltip="{{post.date | date:\'medium\'}}">\n\t\t\t\t\t\t{{post.date | uiHistoryDate}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- type=user.change {{{ --\x3e\n\t\t\t\t<div ng-switch-when="user.change" class="ui-history-user-change">\n\t\t\t\t\t<div class="ui-history-user-change-user">\n\t\t\t\t\t\t<a ng-href="{{post.user.url}}" target="_blank">\n\t\t\t\t\t\t\t<img gravatar-src="post.user.email" gravatar-size="50" gravatar-default="monsterid" tooltip="{{post.user.name}}"/>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div ng-if="post.field" class="ui-history-user-change-main">\n\t\t\t\t\t\tChanged\n\t\t\t\t\t\t{{post.field}}\n\t\t\t\t\t\t<em>{{post.from}}</em>\n\t\t\t\t\t\t<i class="fa fa-long-arrow-right"></i>\n\t\t\t\t\t\t<em>{{post.to}}</em>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div ng-if="post.fields" class="ui-history-user-change-main">\n\t\t\t\t\t\tChanges:\n\t\t\t\t\t\t<div ng-repeat="(field, change) in post.fields track by field">\n\t\t\t\t\t\t\t{{field}}\n\t\t\t\t\t\t\t<em>{{change.from}}</em>\n\t\t\t\t\t\t\t<i class="fa fa-long-arrow-right"></i>\n\t\t\t\t\t\t\t<em>{{change.to}}</em>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- }}} --\x3e\n\t\t\t\t\x3c!-- type=user.comment {{{ --\x3e\n\t\t\t\t<div ng-switch-when="user.comment" class="ui-history-user-comment">\n\t\t\t\t\t<div class="ui-history-user-comment-user">\n\t\t\t\t\t\t<a ng-href="{{post.user.url}}" target="_blank">\n\t\t\t\t\t\t\t<img gravatar-src="post.user.email" gravatar-size="50" gravatar-default="monsterid" tooltip="{{post.user.name}}"/>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-history-user-comment-main">\n\t\t\t\t\t\t<div ng-if="post.title" class="ui-history-user-comment-header">{{post.title}}</div>\n\t\t\t\t\t\t<div class="ui-history-user-comment-body" ng-bind-html="post.body"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- }}} --\x3e\n\t\t\t\t\x3c!-- type=user.upload {{{ --\x3e\n\t\t\t\t<div ng-switch-when="user.upload" class="ui-history-user-upload">\n\t\t\t\t\t<div class="ui-history-user-upload-user">\n\t\t\t\t\t\t<a ng-href="{{post.user.url}}" target="_blank">\n\t\t\t\t\t\t\t<img gravatar-src="post.user.email" gravatar-size="50" gravatar-default="monsterid" tooltip="{{post.user.name}}"/>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-history-user-upload-main">\n\t\t\t\t\t\t<div style="margin-bottom: 10px">Attached files:</div>\n\t\t\t\t\t\t<ul class="list-group">\n\t\t\t\t\t\t\t<a ng-if="post.filename" ng-href="{{post.url}}" target="_blank" class="list-group-item">\n\t\t\t\t\t\t\t\t<div ng-if="post.size" class="pull-right">{{post.size}}</div>\n\t\t\t\t\t\t\t\t<i ng-if="post.icon" class="{{post.icon}}"></i>\n\t\t\t\t\t\t\t\t{{post.filename || \'Unknown file\'}}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t<a ng-if="post.files" ng-repeat="file in post.files track by file.filename" ng-href="{{file.url}}" target="_blank" class="list-group-item">\n\t\t\t\t\t\t\t\t<div ng-if="file.size" class="pull-right">{{file.size}}</div>\n\t\t\t\t\t\t\t\t<i ng-if="file.icon" class="{{file.icon}}"></i>\n\t\t\t\t\t\t\t\t{{file.filename || \'Unknown file\'}}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- }}} --\x3e\n\t\t\t\t\x3c!-- type=user.status {{{ --\x3e\n\t\t\t\t<div ng-switch-when="user.status" class="ui-history-user-status">\n\t\t\t\t\t<div class="ui-history-user-status-user">\n\t\t\t\t\t\t<a ng-href="{{post.user.url}}" target="_blank">\n\t\t\t\t\t\t\t<img gravatar-src="post.user.email" gravatar-size="50" gravatar-default="monsterid" tooltip="{{post.user.name}}"/>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-history-user-status-main" ng-bind-html="post.body"></div>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- }}} --\x3e\n\t\t\t\t\x3c!-- type=system.change {{{ --\x3e\n\t\t\t\t<div ng-switch-when="system.change" class="ui-history-system-change">\n\t\t\t\t\t<div ng-if="post.field">\n\t\t\t\t\t\tChanged\n\t\t\t\t\t\t{{post.field}}\n\t\t\t\t\t\t<em>{{post.from}}</em>\n\t\t\t\t\t\t<i class="fa fa-long-arrow-right"></i>\n\t\t\t\t\t\t<em>{{post.to}}</em>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div ng-if="post.fields">\n\t\t\t\t\t\tChanges:\n\t\t\t\t\t\t<div ng-repeat="(field, change) in post.fields track by field">\n\t\t\t\t\t\t\t{{field}}\n\t\t\t\t\t\t\t<em>{{change.from}}</em>\n\t\t\t\t\t\t\t<i class="fa fa-long-arrow-right"></i>\n\t\t\t\t\t\t\t<em>{{change.to}}</em>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- }}} --\x3e\n\t\t\t\t\x3c!-- type=system.status {{{ --\x3e\n\t\t\t\t<div ng-switch-when="system.status" class="ui-history-system-status" ng-bind-html="post.body"></div>\n\t\t\t\t\x3c!-- }}} --\x3e\n\t\t\t\t\x3c!-- type unknown {{{ --\x3e\n\t\t\t\t<div ng-switch-default class="ui-history-unknown">\n\t\t\t\t\tUnknown history type: [{{post.type}}]\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- }}} --\x3e\n\t\t\t</div>\n\t\t\t<div ng-if="!$ctrl.posts.length" class="text-muted text-center">No history to display</div>\n\t\t\t\x3c!-- Footer editor (if !display || display=\'oldestFirst\') {{{ --\x3e\n\t\t\t<div ng-if="$ctrl.allowPost && (!$ctrl.display || $ctrl.display == \'oldestFirst\')">\n\t\t\t\t<hr/>\n\t\t\t\t<div ng-show="$ctrl.isPosting" class="text-center">\n\t\t\t\t\t<h3><i class="fa fa-spinner fa-spin"></i> Posting...</h3>\n\t\t\t\t</div>\n\t\t\t\t<div ng-show="!$ctrl.isPosting">\n\t\t\t\t\t<ui-history-editor\n\t\t\t\t\t\tbuttons="$ctrl.buttons"\n\t\t\t\t\t\ttemplates="$ctrl.templates"\n\t\t\t\t\t\ton-post="$ctrl.makePost(body)"\n\t\t\t\t\t></ui-history-editor>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!-- }}} --\x3e\n\t\t</div>\n\t',controller:["$element","$http","$sce","$scope","$timeout","uiHistory",function(t,n,i,o,e,s){var a=this;a.posts,a.isLoading=!1,a.refresh=function(){if(!a.queryUrl)throw new Error("queryUrl is undefined");a.isLoading=!0;var t=angular.isString(a.queryUrl)?a.queryUrl:a.queryUrl(a);if(!t)throw new Error("Resovled URL is empty");a.onLoadingStart&&a.onLoadingStart(),n.get(t).then(function(n){if(!angular.isArray(n.data))throw new Error('Expected history feed at URL "'+t+'" to be an array but got something else');a.posts=n.data.map(function(t){return"user.comment"!=t.type&&"user.status"!=t.type&&"system.status"!=t.type||(t.body=i.trustAsHtml(t.body)),t})}).then(function(){if(a.onQuery){var t=a.onQuery({posts:a.posts});angular.isArray(t)&&(a.posts=t)}}).catch(function(t){a.onError&&a.onError({error:t})}).finally(function(){return a.isLoading=!1}).finally(function(){a.onLoadingStop&&a.onLoadingStop()})},a.isPosting=!1,a.makePost=function(t){if(!a.allowPost)throw new Error("Posting not allowed");if(t){var i=angular.isString(a.postUrl)?a.postUrl:angular.isFunction(a.postUrl)?a.postUrl(a):angular.isString(a.queryUrl)?a.queryUrl:angular.isFunction(a.queryUrl)?a.queryUrl(a):void 0;if(!i)throw new Error("Resovled POST URL is empty");return a.isPosting=!0,n.post(i,{body:t}).then(function(){return a.refresh()}).catch(function(t){a.onError&&a.onError({error:t})}).finally(function(){return a.isPosting=!1})}},a.isUploading=!1,t.find("input[type=file]").on("change",function(){var t=this;e(function(){var i=angular.isString(a.postUrl)?a.postUrl:angular.isFunction(a.postUrl)?a.postUrl(a):angular.isString(a.queryUrl)?a.queryUrl:angular.isFunction(a.queryUrl)?a.queryUrl(a):void 0;if(!i)throw new Error("Resovled POST URL is empty");var o=new FormData;Object.keys(t.files).forEach(function(n,i){return o.append("file_"+i,t.files[n])}),a.isUploading=!0,n.post(i,o,{headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(t){a.onUpload&&a.onUpload(t)}).catch(function(t){a.onError&&a.onError({error:t})}).then(function(){return a.refresh()}).finally(function(){return a.isUploading=!1})})}),o.$on("angular-ui-history.button.upload",function(){return a.selectFiles()}),a.selectFiles=function(){return t.find("#angular-ui-history-upload-helper").click()},a.showFilesModal=!1,o.$on("angular-ui-history.button.uploadList",function(){a.showFilesModal=!0,t.find(".angular-ui-history-modal-uploadList").modal("show").one("hidden.bs.modal",function(){return o.$apply(function(){return a.showFilesModal=!0})})}),a.$onInit=function(){for(var t in s.defaults)void 0===a[t]&&(a[t]=s.defaults[t]);a.buttons||(a.buttons=[],a.allowUpload&&((void 0===a.allowUploadList||a.allowUploadList)&&a.buttons.push({title:"File list",icon:"fa fa-folder-o",action:"uploadList"}),a.buttons.push({title:"Upload files...",icon:"fa fa-file-o",action:"upload"}))),o.$watch("$ctrl.queryUrl",function(){return a.refresh()})}}]}).component("uiHistoryEditor",{bindings:{buttons:"<",templates:"<",onPost:"&"},template:'\n\t\t<form ng-submit="$ctrl.makePost()" class="form-horizontal">\n\t\t\t<div class="form-group">\n\t\t\t\t<div class="col-sm-12">\n\t\t\t\t\t<ng-quill-editor ng-model="$ctrl.newPost.body" placeholder="Leave a comment...">\n\t\t\t\t\t\t\x3c!-- ng-quill toolbar config {{{ --\x3e\n\t\t\t\t\t\t<ng-quill-toolbar>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<span class="ql-formats">\n\t\t\t\t\t\t\t\t\t<button class="ql-bold" ng-attr-title="{{\'Bold\'}}"></button>\n\t\t\t\t\t\t\t\t\t<button class="ql-italic" ng-attr-title="{{\'Italic\'}}"></button>\n\t\t\t\t\t\t\t\t\t<button class="ql-underline" ng-attr-title="{{\'Underline\'}}"></button>\n\t\t\t\t\t\t\t\t\t<button class="ql-strike" ng-attr-title="{{\'Strikethough\'}}"></button>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class="ql-formats">\n\t\t\t\t\t\t\t\t\t<button class="ql-blockquote" ng-attr-title="{{\'Block Quote\'}}"></button>\n\t\t\t\t\t\t\t\t\t<button class="ql-code-block" ng-attr-title="{{\'Code Block\'}}"></button>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class="ql-formats">\n\t\t\t\t\t\t\t\t\t<button class="ql-header" value="1" ng-attr-title="{{\'Header 1\'}}"></button>\n\t\t\t\t\t\t\t\t\t<button class="ql-header" value="2" ng-attr-title="{{\'Header 2\'}}"></button>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class="ql-formats">\n\t\t\t\t\t\t\t\t\t<button class="ql-list" value="ordered" ng-attr-title="{{\'Numered list\'}}"></button>\n\t\t\t\t\t\t\t\t\t<button class="ql-list" value="bullet" ng-attr-title="{{\'Bulleted list\'}}"></button>\n\t\t\t\t\t\t\t\t\t<button class="ql-indent" value="-1" ng-attr-title="{{\'De-indent\'}}"></button>\n\t\t\t\t\t\t\t\t\t<button class="ql-indent" value="+1" ng-attr-title="{{\'Indent\'}}"></button>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class="ql-formats">\n\t\t\t\t\t\t\t\t\t<select class="ql-color" ng-attr-title="{{\'Text color\'}}">\n\t\t\t\t\t\t\t\t\t\t<option selected="selected"></option>\n\t\t\t\t\t\t\t\t\t\t<option ng-repeat="color in ::$ctrl.colors" value="{{::color}}"></option>\n\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t<select class="ql-background" ng-attr-title="{{\'Background color\'}}">\n\t\t\t\t\t\t\t\t\t\t<option selected="selected"></option>\n\t\t\t\t\t\t\t\t\t\t<option ng-repeat="color in ::$ctrl.colors" value="{{::color}}"></option>\n\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class="ql-formats">\n\t\t\t\t\t\t\t\t\t<button class="ql-link" value="ordered" ng-attr-title="{{\'Add link\'}}"></button>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class="ql-formats">\n\t\t\t\t\t\t\t\t\t<button class="ql-clean" value="ordered" ng-attr-title="{{\'Clear formatting\'}}"></button>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<div class="pull-right">\n\t\t\t\t\t\t\t\t\t<div class="btn-group">\n\t\t\t\t\t\t\t\t\t\t<a ng-if="$ctrl.templates" class="btn btn-default dropdown-toggle" data-toggle="dropdown">\n\t\t\t\t\t\t\t\t\t\t\tTemplate\n\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-chevron-down"></i>\n\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t<ul class="dropdown-menu">\n\t\t\t\t\t\t\t\t\t\t\t<li ng-repeat="template in $ctrl.templates">\n\t\t\t\t\t\t\t\t\t\t\t\t<a ng-click="$ctrl.setTemplate(template)">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<i ng-if="template.icon" ng-class="template.icon"></i>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{template.title}}\n\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<a ng-repeat="button in $ctrl.buttons" class="btn" ng-class="$ctrl.class || \'btn-default\'" ng-click="$ctrl.runButton(button)">\n\t\t\t\t\t\t\t\t\t\t<i ng-if="button.icon" class="{{button.icon}}"></i>\n\t\t\t\t\t\t\t\t\t\t{{button.title}}\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t<a ng-click="$ctrl.makePost()" class="btn btn-sm btn-success">\n\t\t\t\t\t\t\t\t\t\t<i class="fa fa-plus"></i>\n\t\t\t\t\t\t\t\t\t\tPost\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</ng-quill-toolbar>\n\t\t\t\t\t\t\x3c!-- }}} --\x3e\n\t\t\t\t\t</ng-quill-editor>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t',controller:["$scope",function(t){var n=this;n.colors=["#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],n.newPost={body:""},n.makePost=function(){if(!n.onPost)throw new Error("Post content provided but no onPost binding defined");var t=n.onPost({body:n.newPost.body});t&&angular.isFunction(t.then)&&t.then(function(){return n.newPost={body:""}})},t.$on("angular-ui-history.post",n.makePost),n.runButton=function(n){n.action&&t.$emit("angular-ui-history.button."+n.action,n),t.$emit("angular-ui-history.button",n)},n.setTemplate=function(i){n.newPost.body=i.content,t.$emit("angular-ui-history.template",i)}}]}).component("uiHistoryFiles",{bindings:{allowUpload:"<",queryUrl:"<",postUrl:"<",onError:"&?",onLoadingStart:"&?",onLoadingStop:"&?",onQuery:"&?",onUpload:"&?"},controller:["$http","$scope",function(t,n){var i=this;i.uploads,i.isLoading,i.refresh=function(){if(!i.queryUrl)throw new Error("queryUrl is undefined");var n=angular.isString(i.queryUploadsUrl)?i.queryUploadsUrl:angular.isString(i.queryUrl)?i.queryUrl:i.queryUrl(i);if(!n)throw new Error("Resovled URL for uploads is empty");i.isLoading=!0,i.onLoadingStart&&i.onLoadingStart(),t.get(n).then(function(t){if(!angular.isArray(t.data))throw new Error('Expected file upload feed at URL "'+n+'" to be an array but got something else');i.uploads=t.data.filter(function(t){return void 0===t.type||"user.upload"==t.type}).reduce(function(t,n){return n.filename?(t.push(n),t):n.files?t.concat(n.files):void 0},[]).sort(function(t,n){return t.filename==n.filename?0:t.filename>n.filename?1:-1}).filter(function(t,n,i){return 0==n||i[n-1].filename!=t.filename})}).catch(function(t){i.onError&&i.onError({error:t})}).finally(function(){return i.isLoading=!1}).finally(function(){i.onLoadingStop&&i.onLoadingStop()})},n.$evalAsync(i.refresh)}],template:'\n\t\t<div ng-if="$ctrl.isLoading">\n\t\t\t<h2>\n\t\t\t\t<i class="fa fa-spinner fa-spin"></i>\n\t\t\t\tFetching list of files...\n\t\t\t</h2>\n\t\t</div>\n\t\t<div ng-if="!$ctrl.isLoading && $ctrl.uploads.length == 0" class="text-muted text-center">\n\t\t\tNo file uploads found\n\t\t</div>\n\t\t<ul class="list-group">\n\t\t\t<a ng-repeat="file in $ctrl.uploads track by file.filename" ng-href="{{file.url}}" target="_blank" class="list-group-item">\n\t\t\t\t<div class="pull-right">\n\t\t\t\t\t<span class="badge">{{file.size}}</span>\n\t\t\t\t</div>\n\t\t\t\t{{file.filename}}\n\t\t\t</a>\n\t\t</ul>\n\t'}).filter("uiHistoryDate",function(){return function(t){var n=moment(t);if(!n._isValid)return"Invalid date";var i=moment(Date.now()).diff(n,"days");return i<0?moment(n).fromNow(!0)+" from now":i<1?n.format("h:mma"):1===i?"Yesterday":i>1&&i<7?n.format("dddd"):n.format("D MMMM, YYYY")}});